# -*- coding: utf-8 -*-

from odoo import api, fields, models

class LeadNonExploitableMassLog(models.TransientModel):
    _name = 'crm.lead.nonexploitable.mass'
    _description = 'Log note Opportunity (in mass)'
    
    log_note = fields.Text('Notes pour la mise Ã  jour en Non Exploitable')
    
    def action_mass_log_lead_non_exploitable(self):
        crm_active_ids = self.env.context.get('active_ids')
        if self.log_note:
            for lead in crm_active_ids:
                self.env['crm.lead'].browse(lead).message_post(body=self.log_note)
                #### REMOVE ACTIVITIES ####
                crm_lead = self.env['crm.lead'].browse(lead)
                all_activities = self.env['mail.activity'].sudo().search([('res_id', '=', lead), ('res_model', '=', 'crm.lead'), ('res_name', '=', str(crm_lead.name).strip())])
                for h_act in all_activities:
                    h_act.sudo().unlink()
        return True